<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="theme-color" content="#a61e1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Yahir Cutz Admin">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Yahir Cutz Admin">
  <title>Panel</title>
  <link rel="manifest" href="admin-manifest.webmanifest">
  <link rel="shortcut icon" href="icons/pwa-192.png" type="image/png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/pwa-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/pwa-512.png">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <style>
    :root {
      --primary: #0f0f0f;
      --primary-light: #1a1a1a;
      --accent: #a61e1e;
      --accent-light: #c1272e;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --info: #3b82f6;
      --text: #ffffff;
      --text-light: #b0b0b0;
      --border: #333333;
      --bg: #0f0f0f;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
    
    body {
      background: #0f0f0f;
      color: var(--text);
      min-height: 100vh;
      padding-top: max(0rem, env(safe-area-inset-top));
    }

    /* ===== HEADER ===== */
    header {
      background: #ffffff;
      border-bottom: 5px solid var(--accent);
      box-shadow: 0 12px 30px rgba(0,0,0,0.18);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
      width: 100%;
      padding-top: max(0rem, env(safe-area-inset-top));
    }

    .header-content {
      max-width: 1800px;
      margin: 0 auto;
      padding: 16px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 24px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
      flex: 1;
    }

    .header-logo {
      display: flex;
      align-items: center;
      gap: 14px;
      text-decoration: none;
      color: #a61e1e;
      font-weight: 900;
      font-size: 1.45rem;
      transition: all 0.3s;
      letter-spacing: 0.5px;
    }

    .header-logo:hover {
      color: #8b1717;
    }

    .header-logo img {
      height: 68px;
      width: auto;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.35));
      transition: transform 0.3s ease;
    }

    .header-logo:hover img {
      transform: scale(1.05);
    }

    .header-stats {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .header-stat {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 18px;
      background: rgba(166, 30, 30, 0.08);
      border-radius: 12px;
      border: 1px solid #a61e1e;
      color: #a61e1e;
    }

    .header-stat-value {
      font-weight: 900;
      font-size: 1.3rem;
      color: #a61e1e;
    }

    .header-stat-label {
      font-size: 0.75rem;
      color: #8b1717;
      text-transform: uppercase;
      font-weight: 700;
    }

    .header-right {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .btn-logout {
      padding: 12px 20px;
      background: linear-gradient(135deg, var(--danger), #dc2626);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
    }

    .btn-logout:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
    }

    /* ===== LOGIN ===== */
    .login-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(17,17,17,0.94), rgba(166, 30, 30, 0.4));
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(12px);
      width: 100vw;
      height: 100vh;
      overflow-y: auto;
      overflow-x: hidden;
      overscroll-behavior: contain;
      padding: 32px 16px;
    }

    .login-shell {
      width: min(1100px, 96vw);
      display: flex;
      flex-direction: column;
      gap: 16px;
      align-items: stretch;
      max-height: 92vh;
    }

    .login-main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .login-mini-header {
      background: #ffffff;
      border: 2px solid #a61e1e;
      border-radius: 16px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.25);
      color: #a61e1e;
    }

    .login-mini-header .mini-left {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 900;
      letter-spacing: 0.4px;
      font-size: 1rem;
      color: #a61e1e;
    }

    .login-mini-header .mini-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .login-mini-header img {
      height: 64px;
      width: auto;
      filter: drop-shadow(0 3px 10px rgba(0,0,0,0.45));
    }

    .login-mini-header .mini-pill {
      background: rgba(166, 30, 30, 0.08);
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid #a61e1e;
      font-weight: 800;
      font-size: 0.85rem;
      color: #a61e1e;
    }

    .login-mini-header .mini-pill.secondary {
      background: #a61e1e;
      color: #ffffff;
      border-color: #a61e1e;
      box-shadow: 0 6px 16px rgba(166, 30, 30, 0.25);
    }

    .btn-home {
      background: #ffffff;
      color: #a61e1e;
      border: 2px solid #a61e1e;
      border-radius: 999px;
      padding: 10px 16px;
      font-weight: 800;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.25s ease;
      box-shadow: 0 6px 16px rgba(0,0,0,0.18);
      letter-spacing: 0.2px;
      font-size: 0.95rem;
    }

    .btn-home:hover {
      transform: translateY(-2px);
      border-color: #a61e1e;
      background: #a61e1e;
      color: #ffffff;
    }

    .login-mini-footer {
      background: #0d0d0d;
      border: 2px solid #1f1f1f;
      border-radius: 14px;
      padding: 14px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      color: var(--text-light);
      box-shadow: 0 -6px 20px rgba(0,0,0,0.35);
      flex-wrap: wrap;
    }

    .login-mini-footer .hc-credit {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      color: #ffffff;
      background: rgba(255,255,255,0.06);
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.12);
    }

    .login-mini-footer .hc-credit img {
      height: 28px;
      width: auto;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,0.35));
    }

    @media (max-width: 600px) {
      .login-shell {
        gap: 16px;
      }
      .login-mini-header, .login-mini-footer {
        padding: 12px 14px;
      }
      .login-mini-header img {
        height: 52px;
      }
      .login-mini-header .mini-left {
        font-size: 0.95rem;
      }
      .login-mini-header .mini-actions {
        width: 100%;
        justify-content: flex-start;
      }
      .btn-home {
        width: 100%;
        justify-content: center;
      }
      .login-box {
        padding: 44px 24px;
      }
    }

    .login-mini-footer .footer-socials {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .login-mini-footer .footer-socials img {
      height: 24px;
      width: auto;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.45));
    }

    .login-box {
      background: #121212;
      padding: 56px;
      border-radius: 24px;
      box-shadow: 0 25px 60px rgba(0,0,0,0.5);
      max-width: 500px;
      width: min(500px, 96vw);
      border: 2px solid #a61e1e;
      animation: slideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-box h1 {
      font-size: 2.8rem;
      font-weight: 900;
      margin-bottom: 8px;
      color: #ffffff;
      letter-spacing: 0.6px;
    }

    .login-box p {
      color: #d0d0d0;
      margin-bottom: 40px;
      font-size: 1.05rem;
    }

    .login-form {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .login-form input {
      padding: 16px 18px;
      border: 2px solid #333;
      background: #1c1c1c;
      color: #ffffff;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.3s;
    }

    .login-form input:focus {
      outline: none;
      border-color: var(--accent);
      background: #111;
      box-shadow: 0 0 0 4px rgba(166, 30, 30, 0.3);
    }

    .login-form button {
      padding: 16px;
      background: linear-gradient(135deg, #a61e1e, #8b1717);
      border: none;
      color: white;
      border-radius: 12px;
      font-weight: 900;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 12px 32px rgba(0,0,0,0.35);
      letter-spacing: 0.5px;
    }

    .login-form button:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 48px rgba(17,17,17,0.35);
    }

    .login-error {
      color: white;
      background: linear-gradient(135deg, var(--danger), #dc2626);
      padding: 16px 18px;
      border-radius: 12px;
      margin-bottom: 18px;
      border: 2px solid rgba(255,255,255,0.2);
      font-weight: 700;
      font-size: 0.95rem;
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.25);
      animation: shake 0.3s;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-8px); }
      75% { transform: translateX(8px); }
    }

    .hidden { display: none !important; }

    /* ===== MAIN CONTAINER ===== */
    .admin-container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 40px 32px 24px;
    }

    /* ===== SIDEBAR & LAYOUT ===== */
    .admin-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 32px;
    }

    .sidebar {
      background: var(--bg);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
      border: 2px solid var(--border);
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .sidebar-title {
      font-weight: 900;
      font-size: 0.85rem;
      color: var(--text-light);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 16px;
      margin-left: 8px;
    }

    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: var(--text-light);
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      width: 100%;
      margin-bottom: 8px;
      text-align: left;
      font-size: 0.95rem;
    }

    .sidebar-item:hover {
      background: #f3f4f6;
      color: var(--accent);
      transform: translateX(4px);
    }

    .sidebar-item.active {
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      color: white;
      box-shadow: 0 4px 12px rgba(234, 88, 12, 0.2);
    }

    /* ===== CONTENT ===== */
    .content {
      display: grid;
      gap: 32px;
    }

    .page {
      display: grid;
      gap: 14px;
    }

    .page-title {
      font-size: 2.3rem;
      font-weight: 900;
      margin-bottom: 6px;
      color: #ffffff;
      letter-spacing: 0.3px;
      text-align: center;
    }

    .page-lead {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 18px;
      padding: 16px 18px;
      background: linear-gradient(135deg, rgba(166,30,30,0.14), rgba(17,17,17,0.7));
      border: 1px solid rgba(166,30,30,0.35);
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.28);
      justify-content: center;
      text-align: center;
    }

    .page-pill {
      background: #a61e1e;
      color: #ffffff;
      border: 1px solid #a61e1e;
      padding: 8px 14px;
      border-radius: 999px;
      font-weight: 850;
      font-size: 0.96rem;
      letter-spacing: 0.25px;
      box-shadow: 0 8px 18px rgba(166,30,30,0.3);
    }

    .page-subtitle {
      color: #e5e5e5;
      font-size: 1.08rem;
      font-weight: 700;
      letter-spacing: 0.12px;
      margin: 0 auto;
      max-width: 720px;
    }

    /* ===== CARDS & SECTIONS ===== */
    .card {
      background: #121212;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 8px 22px rgba(0,0,0,0.35);
      border: 2px solid #1f1f1f;
      transition: all 0.3s;
    }

    .card:hover {
      box-shadow: 0 14px 36px rgba(0,0,0,0.45);
      border-color: var(--accent);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
      gap: 16px;
      flex-wrap: wrap;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }

    .card-title {
      font-size: 1.6rem;
      font-weight: 900;
      color: #ffffff;
    }

    .card-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* ===== STATS GRID ===== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: linear-gradient(135deg, #161616 0%, #1f1f1f 100%);
      border: 2px solid #232323;
      padding: 28px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.35);
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
    }

    .stat-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 18px 44px rgba(0,0,0,0.5);
      border-color: var(--accent);
    }

    .stat-icon {
      font-size: 2.4rem;
      margin-bottom: 12px;
    }

    .stat-label {
      color: var(--text-light);
      font-weight: 700;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 2.6rem;
      font-weight: 900;
      color: #ffffff;
      line-height: 1;
      margin-bottom: 8px;
    }

    .stat-subtext {
      font-size: 0.85rem;
      color: var(--text-light);
      font-weight: 600;
    }

    /* ===== APPOINTMENTS TABLE ===== */
    .appointments-grid {
      display: grid;
      gap: 16px;
    }

    .appointment-item {
      background: linear-gradient(135deg, #161616 0%, #1d1d1d 100%);
      border: 2px solid #232323;
      padding: 24px;
      border-radius: 14px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 24px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.35);
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .appointment-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
    }

    .appointment-item:hover {
      box-shadow: 0 16px 36px rgba(0,0,0,0.45);
      transform: translateY(-3px);
      border-color: var(--accent);
    }

    .appointment-info {
      flex: 1;
      padding-left: 12px;
    }

    .appointment-name {
      font-weight: 900;
      font-size: 1.2rem;
      color: var(--text);
      margin-bottom: 12px;
    }

    .appointment-details {
      display: grid;
      gap: 10px;
      font-size: 0.95rem;
      color: var(--text-light);
    }

    .appointment-detail {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .appointment-detail strong {
      color: var(--text);
      font-weight: 700;
      min-width: 80px;
    }

    .appointment-actions {
      display: flex;
      gap: 10px;
      flex-direction: column;
      justify-content: center;
      min-width: 150px;
    }

    /* ===== BUTTONS ===== */
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      color: white;
      box-shadow: 0 6px 16px rgba(0,0,0,0.35);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(0,0,0,0.45);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success), #059669);
      color: white;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #dc2626);
      color: white;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
    }

    .btn-info {
      background: linear-gradient(135deg, var(--info), #2563eb);
      color: white;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
    }

    .btn-info:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
    }

    .btn-outline {
      background: #0f0f0f;
      border: 2px solid #333;
      color: #ffffff;
    }

    .btn-outline:hover {
      background: #1a1a1a;
      border-color: var(--accent);
      color: var(--accent);
    }

    /* ===== FILTERS ===== */
    .filters {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 24px;
    }

    .filter-input {
      padding: 12px 16px;
      border: 2px solid var(--border);
      background: #f9fafb;
      color: var(--text);
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.3s;
    }

    .filter-input:focus {
      outline: none;
      border-color: var(--accent);
      background: white;
      box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.15);
    }

    /* ===== MODAL ===== */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 500;
      backdrop-filter: blur(4px);
    }

    .modal.active {
      display: flex;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: var(--bg);
      padding: 40px;
      border-radius: 18px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 25px 60px rgba(0,0,0,0.3);
      border: 2px solid var(--border);
      animation: slideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes slideUp {
      from {
        transform: translateY(40px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      font-size: 1.8rem;
      font-weight: 900;
      margin-bottom: 28px;
      color: var(--text);
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 18px;
    }

    .form-group label {
      font-weight: 700;
      font-size: 0.95rem;
      color: var(--text);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 14px 16px;
      border: 2px solid var(--border);
      background: #f9fafb;
      color: var(--text);
      border-radius: 10px;
      font-family: inherit;
      font-size: 0.95rem;
      font-weight: 500;
      transition: all 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--accent);
      background: white;
      box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.15);
    }

    .modal-footer {
      display: flex;
      gap: 12px;
      margin-top: 32px;
    }

    .modal-footer button {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
    }

    /* ===== NO DATA ===== */
    .no-data {
      text-align: center;
      padding: 60px 32px;
      color: var(--text-light);
      font-size: 1.05rem;
      font-weight: 600;
      background: linear-gradient(135deg, #151515, #1d1d1d);
      border-radius: 12px;
      border: 2px dashed var(--border);
    }

    /* ===== CHARTS ===== */
    .chart-container {
      position: relative;
      height: 300px;
      margin-bottom: 24px;
    }

    /* ===== FOOTER ===== */
    .admin-footer {
      background: #000000;
      border-top: 4px solid var(--accent);
      padding: 48px 32px 32px;
      margin-top: 32px;
      box-shadow: 0 -12px 40px rgba(0,0,0,0.4);
    }

    .admin-footer .footer-inner {
      max-width: 1800px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 24px;
    }

    .admin-footer h4 {
      margin: 0 0 12px 0;
      color: #ffffff;
      font-weight: 800;
      letter-spacing: 0.3px;
    }

    .admin-footer p, .admin-footer a, .admin-footer li {
      color: var(--text-light);
      font-weight: 600;
      line-height: 1.6;
      list-style: none;
    }

    .admin-footer .footer-branding img {
      height: 64px;
      width: auto;
      filter: drop-shadow(0 4px 12px rgba(0,0,0,0.45));
      margin-bottom: 12px;
    }

    .admin-footer .footer-socials {
      display: flex;
      gap: 12px;
      margin-top: 12px;
    }

    .admin-footer .footer-socials img {
      height: 26px;
      width: auto;
    }

    .admin-footer .footer-links {
      display: grid;
      gap: 8px;
      padding: 0;
      margin: 0;
    }

    .admin-footer .footer-bottom {
      margin-top: 24px;
      padding-top: 20px;
      border-top: 1px solid #1f1f1f;
      color: var(--text-light);
      font-weight: 600;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .admin-footer .brand-strip {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      color: #ffffff;
      font-weight: 700;
    }

    .admin-footer .brand-strip span {
      color: #ffffff;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1024px) {
      .admin-layout {
        grid-template-columns: 1fr;
      }

      .sidebar {
        position: relative;
        top: 0;
        display: flex;
        gap: 12px;
        padding: 16px;
        overflow-x: auto;
      }

      .sidebar-item {
        flex: 1;
        margin-bottom: 0;
        padding: 10px 12px;
        font-size: 0.85rem;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .appointment-item {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .appointment-actions {
        flex-direction: row;
        min-width: auto;
      }
    }

    @media (max-width: 768px) {
      .admin-container {
        padding: 20px 16px;
      }

      .header-content {
        padding: 12px 14px;
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }

      .header-right {
        width: 100%;
        justify-content: flex-start;
      }

      .btn-logout {
        width: 100%;
      }

      .header-left {
        width: 100%;
        min-width: auto;
      }

      .header-stats {
        width: 100%;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 8px;
      }

      .sidebar {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
        gap: 10px;
        padding: 12px;
        position: relative;
      }

      .sidebar-title {
        grid-column: 1 / -1;
      }

      .sidebar-item {
        padding: 10px;
        margin-bottom: 0;
        font-size: 0.8rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .content {
        gap: 20px;
      }

      .card {
        padding: 20px;
      }

      .page-title {
        font-size: 1.6rem;
      }

      .modal-content {
        padding: 24px;
      }

      .filters {
        flex-direction: column;
      }

      .filter-input {
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      body {
        font-size: 14px;
      }

      .login-overlay {
        align-items: center;
        padding: 20px 12px;
      }

      .admin-container {
        padding: 12px 8px;
      }

      .header-content {
        padding: 10px 10px;
        gap: 8px;
        align-items: stretch;
      }

      .header-logo {
        font-size: 1.1rem;
        gap: 8px;
      }

      .header-logo img {
        height: 56px;
      }

      .header-right {
        flex-shrink: 0;
      }

      .btn-logout {
        padding: 10px 14px;
        font-size: 0.8rem;
      }

      .sidebar {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .sidebar-item {
        padding: 8px 8px;
        font-size: 0.78rem;
        gap: 4px;
        justify-content: center;
      }

      .page-title {
        font-size: 1.4rem;
      }

      .stat-value {
        font-size: 1.8rem;
      }

      .stat-icon {
        font-size: 2rem;
      }

      .card {
        padding: 12px;
        border-radius: 10px;
      }

      .card-title {
        font-size: 1rem;
      }

      .card-header {
        gap: 8px;
        margin-bottom: 16px;
        padding-bottom: 12px;
      }

      .appointment-name {
        font-size: 1rem;
      }

      .appointment-details {
        font-size: 0.8rem;
        gap: 6px;
      }

      .appointment-item {
        padding: 16px;
        gap: 12px;
      }

      .appointment-actions {
        min-width: auto;
        gap: 6px;
      }

      .btn {
        padding: 10px 12px;
        font-size: 0.75rem;
        gap: 4px;
        width: 100%;
      }

      .login-box {
        padding: 36px 22px;
        max-width: 320px;
      }

      .login-box h1 {
        font-size: 2rem;
      }

      .login-box p {
        font-size: 0.95rem;
      }

      .modal-content {
        padding: 24px 16px;
        max-width: 90vw;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        font-size: 16px;
        width: 100%;
      }

      .login-shell {
        width: 100%;
        max-height: none;
      }

      .login-mini-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        width: 100%;
      }

      .login-mini-header img {
        height: 56px;
      }

      .login-mini-header .mini-actions {
        width: 100%;
        justify-content: space-between;
      }

      .btn-home {
        width: 100%;
        justify-content: center;
      }

      .login-mini-footer {
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
      }

      .login-mini-footer .hc-credit {
        width: 100%;
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>

  <!-- LOGIN OVERLAY -->
  <div class="login-overlay" id="loginOverlay">
    <div class="login-shell">
      <div class="login-mini-header">
        <div class="mini-left">
          <img src="img/logoyahircartoon-nobackground.png" alt="Logo Yahir Cutz">
          <span>Yahir Cutz</span>
        </div>
        <div class="mini-actions">
          <a class="btn-home" href="/index.html">Ir a la p√°gina principal</a>
          <div class="mini-pill secondary">Panel de administraci√≥n</div>
          <div class="mini-pill">Acceso seguro</div>
        </div>
      </div>

      <div class="login-main">
        <div class="login-box">
          <h1>Yahir Cutz</h1>
          <p>Panel de administraci√≥n</p>
          <div class="login-error hidden" id="loginError"></div>
          <form class="login-form" id="loginForm">
            <input type="password" id="password" placeholder="Contrase√±a" autocomplete="current-password" required>
            <button type="submit">üîì Ingresar al panel</button>
          </form>
        </div>
      </div>

      <div class="login-mini-footer">
        <span>¬© 2026 Yahir Cutz. Administraci√≥n interna.</span>
        <div class="footer-socials">
          <a href="https://www.instagram.com/yahircutz__" target="_blank" aria-label="Instagram">
            <img src="img/logo ig.gif" alt="Instagram">
          </a>
          <a href="https://wa.me/17872131124" target="_blank" aria-label="WhatsApp">
            <img src="img/logo wa.gif" alt="WhatsApp">
          </a>
          <a href="https://www.tiktok.com/@yahircutz" target="_blank" aria-label="TikTok">
            <img src="img/logo tik tok.gif" alt="TikTok">
          </a>
        </div>
        <div class="hc-credit">
          <img src="https://www.highcloud8.com/img/highcloud8.png" alt="High Cloud 8">
          <span>Designed by High Cloud 8</span>
        </div>
      </div>
    </div>
  </div>

  <!-- HEADER -->
  <header>
    <div class="header-content">
      <div class="header-left">
        <a href="/" class="header-logo">
          <img src="img/logoyahircartoon-nobackground.png" alt="Logo">
          <span>Panel De Administraci√≥n</span>
        </a>
      </div>

      <div class="header-stats" id="headerStats">
        <div class="header-stat">
          <span>üìÖ</span>
          <div>
            <div class="header-stat-value" id="headerCitas">0</div>
            <div class="header-stat-label">Citas hoy</div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN CONTAINER -->
  <div class="admin-container hidden" id="adminContent">
    
    <div class="admin-layout">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="sidebar-title">Men√∫</div>
        <button class="sidebar-item active" onclick="switchPage('dashboard')">üìä Dashboard</button>
        <button class="sidebar-item" onclick="switchPage('appointments')">üìÖ Citas</button>
        <button class="sidebar-item" onclick="switchPage('services')">üõ†Ô∏è Servicios</button>
        <button class="sidebar-item" onclick="switchPage('hours')">‚è∞ Horarios</button>
        <button class="sidebar-item" onclick="switchPage('revenues')">üíµ Ingresos</button>
        <button class="sidebar-item" onclick="switchPage('promotion')">üì¢ Promoci√≥n</button>
      </aside>

      <!-- CONTENT -->
      <main class="content">

        <!-- DASHBOARD PAGE -->
        <div class="page" id="dashboardPage">
          <h1 class="page-title">üìä Dashboard</h1>
          <div class="page-lead">
            <span class="page-pill">Bienvenido</span>
            <p class="page-subtitle">Panel de control, citas e ingresos</p>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üìÖ</div>
              <div class="stat-label">Citas hoy</div>
              <div class="stat-value" id="todayAppointments">0</div>
              <div class="stat-subtext">Reservadas</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üí∞</div>
              <div class="stat-label">Ingresos hoy</div>
              <div class="stat-value" id="todayIncome">$0</div>
              <div class="stat-subtext">Monto total</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üìÜ</div>
              <div class="stat-label">Ingreso semanal</div>
              <div class="stat-value" id="weekIncome">$0</div>
              <div class="stat-subtext">√öltimos 7 d√≠as</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üìä</div>
              <div class="stat-label">Mes actual</div>
              <div class="stat-value" id="monthAppointments">0</div>
              <div class="stat-subtext">Citas registradas</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üéØ</div>
              <div class="stat-label">Ingresos mes</div>
              <div class="stat-value" id="monthIncome">$0</div>
              <div class="stat-subtext">Monto total</div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">üïê Pr√≥ximas citas de hoy</h2>
              <button class="btn btn-primary" onclick="switchPage('appointments')">Ver todas</button>
            </div>
            <div class="appointments-grid" id="todayAppointmentsList">
              <div class="no-data">No hay citas para hoy</div>
            </div>
          </div>
        </div>

        <!-- APPOINTMENTS PAGE -->
        <div class="page hidden" id="appointmentsPage">
          <h1 class="page-title">üìÖ Gesti√≥n de citas</h1>
          <div class="page-lead">
            <span class="page-pill">Citas</span>
            <p class="page-subtitle">Administra, filtra y confirma tus reservas</p>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Filtros</h2>
            </div>
            <div class="filters">
              <input type="date" class="filter-input" id="filterDate" placeholder="Filtrar por fecha">
              <select class="filter-input" id="filterStatus">
                <option value="">Todos los estados</option>
                <option value="confirmed">Confirmadas</option>
                <option value="completed">Completadas</option>
                <option value="cancelled">Canceladas</option>
              </select>
              <button class="btn btn-primary" onclick="loadAppointments()">üîç Filtrar</button>
              <button class="btn btn-outline" onclick="clearFilters()">üîÑ Limpiar</button>
            </div>
          </div>

          <div class="card">
            <div class="appointments-grid" id="appointmentsList">
              <div class="no-data">Cargando citas...</div>
            </div>
          </div>
        </div>

        <!-- SERVICES PAGE -->
        <div class="page hidden" id="servicesPage">
          <h1 class="page-title">üõ†Ô∏è Servicios</h1>
          <div class="page-lead">
            <span class="page-pill">Servicios</span>
            <p class="page-subtitle">Configura tu cat√°logo, precios y duraciones</p>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Servicios disponibles</h2>
              <button class="btn btn-primary" onclick="openServiceModal()">‚ûï Nuevo servicio</button>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px;" id="servicesList">
              <div class="no-data" style="grid-column: 1 / -1;">Cargando servicios...</div>
            </div>
          </div>
        </div>

        <!-- HOURS PAGE -->
        <div class="page hidden" id="hoursPage">
          <h1 class="page-title">‚è∞ Configurar horarios</h1>
          <div class="page-lead">
            <span class="page-pill">Horarios</span>
            <p class="page-subtitle">Establece disponibilidad, bloques y descansos</p>
          </div>

          <div class="card">
            <div id="hoursList" style="display: grid; gap: 16px;">
              <div class="no-data">Cargando horarios...</div>
            </div>
          </div>
        </div>

        <!-- REVENUES PAGE -->
        <div class="page hidden" id="revenuesPage">
          <h1 class="page-title">üíµ Ingresos</h1>
          <div class="page-lead">
            <span class="page-pill">Ingresos</span>
            <p class="page-subtitle">Totales diarios, semanales, mensuales y anuales</p>
          </div>

          <div class="stats-grid" id="revenueCards">
            <div class="stat-card">
              <div class="stat-icon">üìÖ</div>
              <div class="stat-label">Hoy</div>
              <div class="stat-value" id="revToday">$0</div>
              <div class="stat-subtext">Ingresos del d√≠a</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üìÜ</div>
              <div class="stat-label">Semana</div>
              <div class="stat-value" id="revWeek">$0</div>
              <div class="stat-subtext">√öltimos 7 d√≠as</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üìä</div>
              <div class="stat-label">Mes</div>
              <div class="stat-value" id="revMonth">$0</div>
              <div class="stat-subtext">Mes en curso</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üéØ</div>
              <div class="stat-label">A√±o</div>
              <div class="stat-value" id="revYear">$0</div>
              <div class="stat-subtext">A√±o en curso</div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Ingresos por d√≠a (√∫ltimos 7 d√≠as)</h2>
            </div>
            <div id="revDailyList" style="display: grid; gap: 12px;">
              <div class="no-data">Cargando ingresos...</div>
            </div>
          </div>
        </div>

        <!-- PROMOTION PAGE -->
        <div class="page hidden" id="promotionPage">
          <h1 class="page-title">üì¢ Promoci√≥n WhatsApp</h1>
          <div class="page-lead">
            <span class="page-pill">Promoci√≥n</span>
            <p class="page-subtitle">Env√≠a recordatorios o promos a clientes que ya reservaron</p>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Mensaje</h2>
            </div>
            <div class="form-group">
              <label>Contenido</label>
              <textarea id="promoMessage" rows="4" placeholder="Escribe tu promo o recordatorio"></textarea>
            </div>
            <div class="form-group">
              <label>Fotos o im√°genes <small style="color: var(--text-light);">(opcional)</small></label>
              <input type="file" id="promoImages" multiple accept="image/*" style="padding: 12px 16px; border: 2px dashed var(--border); background: #1c1c1c; color: #ffffff; border-radius: 10px; cursor: pointer;">
              <div id="promoImagePreview" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 12px;"></div>
            </div>
            <div class="form-group">
              <label>Clientes (se seleccionan autom√°ticamente)</label>
              <div id="promoClients" style="display: grid; gap: 10px;"></div>
            </div>
            <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
              <button class="btn btn-primary" onclick="sendPromotion()">üöÄ Enviar promoci√≥n</button>
              <button class="btn btn-outline" onclick="loadPromotion()">üîÑ Actualizar lista</button>
            </div>
            <p style="color: var(--text-light); margin-top: 12px;">Se usar√°n los tel√©fonos de las citas registradas.</p>
          </div>
        </div>

      </main>
    </div>
  </div>
  
  <footer class="admin-footer">
    <div class="footer-inner">
      <div class="footer-section footer-branding">
        <img src="img/logoyahircutzog.png" alt="Yahir Cutz">
        <p>Panel de administraci√≥n para Yahir Cutz. Gestiona citas, servicios, horarios e ingresos en un solo lugar.</p>
        <div class="footer-socials">
          <a href="https://www.instagram.com/yahircutz__" target="_blank" aria-label="Instagram">
            <img src="img/logo ig.gif" alt="Instagram">
          </a>
          <a href="https://wa.me/17872131124" target="_blank" aria-label="WhatsApp">
            <img src="img/logo wa.gif" alt="WhatsApp">
          </a>
          <a href="https://www.tiktok.com/@yahircutz" target="_blank" aria-label="TikTok">
            <img src="img/logo tik tok.gif" alt="TikTok">
          </a>
        </div>
      </div>

      <div class="footer-section">
        <h4>Navegaci√≥n</h4>
        <div class="footer-links">
          <a href="#" onclick="switchPage('dashboard'); return false;">Dashboard</a>
          <a href="#" onclick="switchPage('appointments'); return false;">Citas</a>
          <a href="#" onclick="switchPage('services'); return false;">Servicios</a>
          <a href="#" onclick="switchPage('hours'); return false;">Horarios</a>
          <a href="#" onclick="switchPage('revenues'); return false;">Ingresos</a>
          <a href="#" onclick="switchPage('promotion'); return false;">Promoci√≥n</a>
        </div>
      </div>

      <div class="footer-section">
        <h4>Contacto</h4>
        <div class="footer-links">
          <span>üìû +1 (787) 213-1124</span>
          <span>üìç Carolina, PR</span>
          <span>‚úÇÔ∏è Los M√°gicos Barbershop</span>
        </div>
      </div>
    </div>

    <div class="footer-bottom">
      <div class="brand-strip">
        <span>‚úÇÔ∏è</span><span>Experiencia Premium</span><span>|</span><span>üìç Carolina, PR</span>
      </div>
      <span style="flex:1"></span>
      <span>¬© 2026 Yahir Cutz. Todos los derechos reservados.</span>
    </div>
  </footer>

  <!-- MODALS -->
  <div class="modal" id="serviceModal">
    <div class="modal-content">
      <div class="modal-header">‚ûï Nuevo servicio</div>
      <form id="serviceForm">
        <div class="form-group">
          <label>Nombre</label>
          <input type="text" id="serviceName" placeholder="Ej: Corte cl√°sico" required>
        </div>
        <div class="form-group">
          <label>Duraci√≥n (minutos)</label>
          <input type="number" id="serviceDuration" placeholder="45" min="15" step="15" required>
        </div>
        <div class="form-group">
          <label>Precio ($)</label>
          <input type="number" id="servicePrice" placeholder="40" min="0" step="0.01" required>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" style="flex: 1;">üíæ Guardar</button>
          <button type="button" class="btn btn-outline" style="flex: 1;" onclick="closeServiceModal()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:3001';
    const ADMIN_PASSWORD = 'yahir213';
    const STATE = {
      isLoggedIn: false,
      appointments: [],
      services: [],
      hours: []
    };

    function priceForAppointment(appt, serviceMap) {
      const svc = serviceMap[appt.service_id];
      const svcPrice = svc ? Number(svc.price || 0) : 0;
      return Number(appt.price || svcPrice || 0);
    }

    function computeRevenueTotals(appointments, services) {
      const serviceMap = Object.fromEntries(services.map(s => [s.id, s]));
      const today = new Date();
      const todayStr = today.toISOString().split('T')[0];
      const startWeek = new Date();
      startWeek.setDate(today.getDate() - 6);
      let totals = { today: 0, week: 0, month: 0, year: 0 };
      const daily = {};

      appointments
        .filter(a => a.status !== 'cancelled')
        .forEach(a => {
          const price = priceForAppointment(a, serviceMap);
          const d = new Date(a.date + 'T00:00:00');
          if (a.date === todayStr) totals.today += price;
          if (d >= startWeek && d <= today) totals.week += price;
          if (d.getFullYear() === today.getFullYear() && d.getMonth() === today.getMonth()) totals.month += price;
          if (d.getFullYear() === today.getFullYear()) totals.year += price;
          const key = a.date;
          daily[key] = (daily[key] || 0) + price;
        });

      const dailyList = Object.entries(daily)
        .sort((a, b) => new Date(b[0]) - new Date(a[0]))
        .slice(0, 7)
        .map(([date, amount]) => ({ date, amount }));

      return { totals, dailyList };
    }

    // ===== LOGIN =====
    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const pwd = document.getElementById('password').value;
      if(pwd === ADMIN_PASSWORD) {
        STATE.isLoggedIn = true;
        document.getElementById('loginOverlay').classList.add('hidden');
        document.getElementById('adminContent').classList.remove('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
        loadDashboard();
      } else {
        const err = document.getElementById('loginError');
        err.textContent = '‚ùå Contrase√±a incorrecta';
        err.classList.remove('hidden');
        setTimeout(() => err.classList.add('hidden'), 3000);
      }
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
      STATE.isLoggedIn = false;
      document.getElementById('adminContent').classList.add('hidden');
      document.getElementById('loginOverlay').classList.remove('hidden');
      document.getElementById('password').value = '';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // ===== PAGE SWITCHING =====
    function switchPage(page) {
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      document.querySelectorAll('.sidebar-item').forEach(s => s.classList.remove('active'));
      const target = (typeof event !== 'undefined' && event?.currentTarget) ? event.currentTarget : null;
      document.getElementById(page + 'Page').classList.remove('hidden');
      if(target) target.classList.add('active');
      else document.querySelector(`.sidebar-item[onclick*="${page}"]`)?.classList.add('active');

      if(page === 'appointments') loadAppointments();
      else if(page === 'services') loadServices();
      else if(page === 'hours') loadHours();
      else if(page === 'revenues') loadRevenues();
      else if(page === 'promotion') loadPromotion();
    }

    // ===== DASHBOARD =====
    async function loadDashboard() {
      try {
        const [statsRes, allRes, servicesRes] = await Promise.all([
          fetch(`${API_BASE}/api/admin/stats`),
          fetch(`${API_BASE}/api/admin/appointments`),
          fetch(`${API_BASE}/services`)
        ]);

        const stats = await statsRes.json();
        const allAppts = await allRes.json();
        STATE.appointments = allAppts;
        STATE.services = await servicesRes.json();

        document.getElementById('todayAppointments').textContent = stats.today.appointments;
        document.getElementById('todayIncome').textContent = '$' + stats.today.income.toFixed(2);
        document.getElementById('monthAppointments').textContent = stats.month.appointments;
        document.getElementById('monthIncome').textContent = '$' + stats.month.income.toFixed(2);
        document.getElementById('headerCitas').textContent = stats.today.appointments;

        const revenue = computeRevenueTotals(allAppts, STATE.services);
        document.getElementById('weekIncome').textContent = '$' + revenue.totals.week.toFixed(2);

        const today = new Date().toISOString().split('T')[0];
        const todayAppts = allAppts.filter(a => a.date === today).sort((a, b) => 
          a.start_time.localeCompare(b.start_time)
        ).slice(0, 5);

        const list = document.getElementById('todayAppointmentsList');
        if(todayAppts.length === 0) {
          list.innerHTML = '<div class="no-data" style="grid-column: 1 / -1;">No hay citas para hoy ‚ú®</div>';
        } else {
          list.innerHTML = todayAppts.map(a => `
            <div class="appointment-item">
              <div class="appointment-info">
                <div class="appointment-name" style="color: #ffffff;">${a.customer_name}</div>
                <div class="appointment-details">
                  <div class="appointment-detail">
                    <strong>‚è∞</strong> ${a.start_time} - ${a.end_time}
                  </div>
                  <div class="appointment-detail">
                    <strong>üõ†Ô∏è</strong> ${a.service_id}
                  </div>
                  <div class="appointment-detail">
                    <strong>üì±</strong> ${a.phone}
                  </div>
                </div>
              </div>
              <div class="appointment-actions">
                <button class="btn btn-success" onclick="markComplete('${a.id}')">‚úì Completar</button>
                <button class="btn btn-danger" onclick="deleteAppointment('${a.id}')">‚úï Eliminar</button>
              </div>
            </div>
          `).join('');
        }
      } catch(err) {
        console.error('Error:', err);
      }
    }

    // ===== APPOINTMENTS =====
    async function loadAppointments() {
      try {
        const res = await fetch(`${API_BASE}/api/admin/appointments`);
        STATE.appointments = await res.json();
        STATE.appointments.sort((a, b) => 
          new Date(`${a.date} ${a.start_time}`) - new Date(`${b.date} ${b.start_time}`)
        );
        const dateFilter = document.getElementById('filterDate').value;
        const statusFilter = document.getElementById('filterStatus').value;
        const filtered = STATE.appointments.filter(a => {
          const matchDate = dateFilter ? a.date === dateFilter : true;
          const matchStatus = statusFilter ? a.status === statusFilter : true;
          return matchDate && matchStatus;
        });
        renderAppointments(filtered);
      } catch(err) {
        console.error('Error:', err);
      }
    }

    function renderAppointments(appts) {
      const list = document.getElementById('appointmentsList');
      if(appts.length === 0) {
        list.innerHTML = '<div class="no-data" style="grid-column: 1 / -1;">No hay citas</div>';
      } else {
        list.innerHTML = appts.map(a => `
          <div class="appointment-item">
            <div class="appointment-info">
              <div class="appointment-name" style="color: #ffffff;">${a.customer_name}</div>
              <div class="appointment-details">
                <div class="appointment-detail">
                  <strong>üìÖ</strong> ${a.date} a las ${a.start_time}
                </div>
                <div class="appointment-detail">
                  <strong>üõ†Ô∏è</strong> ${a.service_id}
                </div>
                <div class="appointment-detail">
                  <strong>üì±</strong> ${a.phone}
                </div>
                <div class="appointment-detail">
                  <strong>üìß</strong> ${a.email || 'No disponible'}
                </div>
              </div>
            </div>
            <div class="appointment-actions">
              <button class="btn btn-success" onclick="markComplete('${a.id}')">‚úì Completar</button>
              <button class="btn btn-danger" onclick="deleteAppointment('${a.id}')">‚úï Eliminar</button>
            </div>
          </div>
        `).join('');
      }
    }

    function clearFilters() {
      document.getElementById('filterDate').value = '';
      document.getElementById('filterStatus').value = '';
      renderAppointments(STATE.appointments);
    }

    async function markComplete(id) {
      try {
        await fetch(`${API_BASE}/api/admin/appointments/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status: 'completed' })
        });
        loadAppointments();
        loadDashboard();
      } catch(err) {
        console.error('Error:', err);
      }
    }

    async function deleteAppointment(id) {
      if(!confirm('¬øEliminar esta cita?')) return;
      try {
        await fetch(`${API_BASE}/api/admin/appointments/${id}`, { method: 'DELETE' });
        loadAppointments();
        loadDashboard();
      } catch(err) {
        console.error('Error:', err);
      }
    }

    // ===== SERVICES =====
    async function loadServices() {
      try {
        const res = await fetch(`${API_BASE}/services`);
        STATE.services = await res.json();
        const list = document.getElementById('servicesList');
        if(STATE.services.length === 0) {
          list.innerHTML = '<div class="no-data" style="grid-column: 1 / -1;">No hay servicios</div>';
        } else {
          list.innerHTML = STATE.services.map(s => `
            <div class="card">
              <div style="font-weight: 900; font-size: 1.2rem; margin-bottom: 8px; color: #ffffff;">${s.name}</div>
              <div style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 12px;">
                ‚è±Ô∏è ${s.duration_min} minutos
              </div>
              <div style="font-size: 2rem; font-weight: 900; color: #ffffff; margin-bottom: 16px;">
                $${s.price}
              </div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-danger" style="flex: 1;" onclick="deleteService('${s.id}')">üóëÔ∏è Eliminar</button>
              </div>
            </div>
          `).join('');
        }
      } catch(err) {
        console.error('Error:', err);
      }
    }

    function openServiceModal() {
      document.getElementById('serviceForm').reset();
      document.getElementById('serviceModal').classList.add('active');
    }

    function closeServiceModal() {
      document.getElementById('serviceModal').classList.remove('active');
    }

    document.getElementById('serviceForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        await fetch(`${API_BASE}/api/admin/services`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: document.getElementById('serviceName').value,
            duration_min: parseInt(document.getElementById('serviceDuration').value),
            price: parseFloat(document.getElementById('servicePrice').value)
          })
        });
        closeServiceModal();
        loadServices();
      } catch(err) {
        console.error('Error:', err);
      }
    });

    async function deleteService(id) {
      if(!confirm('¬øEliminar este servicio?')) return;
      try {
        await fetch(`${API_BASE}/api/admin/services/${id}`, { method: 'DELETE' });
        loadServices();
      } catch(err) {
        console.error('Error:', err);
      }
    }

    // ===== HOURS =====
    async function loadHours() {
      try {
        const res = await fetch(`${API_BASE}/api/admin/hours`);
        STATE.hours = await res.json();
        const days = ['üåô Domingo', 'üìç Lunes', 'üìç Martes', 'üìç Mi√©rcoles', 'üìç Jueves', 'üìç Viernes', 'üìç S√°bado'];
        const list = document.getElementById('hoursList');
        list.innerHTML = STATE.hours.map(h => `
          <div style="background: linear-gradient(135deg, var(--bg) 0%, #fafbfc 100%); padding: 24px; border-radius: 14px; border: 2px solid var(--border); display: grid; grid-template-columns: 1fr auto; gap: 20px; align-items: center;">
            <div>
              <div style="font-weight: 900; font-size: 1.1rem; margin-bottom: 12px;">${days[h.day_of_week]}</div>
              <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                <input type="time" value="${h.open_time}" onchange="updateHours(${h.day_of_week}, this.value, '${h.close_time}')" style="padding: 10px 14px; border: 2px solid var(--border); border-radius: 8px; font-weight: 600;">
                <span style="color: var(--text-light); font-weight: 700;">a</span>
                <input type="time" value="${h.close_time}" onchange="updateHours(${h.day_of_week}, '${h.open_time}', this.value)" style="padding: 10px 14px; border: 2px solid var(--border); border-radius: 8px; font-weight: 600;">
              </div>
            </div>
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; white-space: nowrap;">
              <input type="checkbox" ${h.is_closed ? 'checked' : ''} onchange="updateHours(${h.day_of_week}, '${h.open_time}', '${h.close_time}', this.checked)" style="width: 20px; height: 20px; cursor: pointer;">
              <span style="font-weight: 700;">D√≠a libre</span>
            </label>
          </div>
        `).join('');
      } catch(err) {
        console.error('Error:', err);
      }
    }

    async function updateHours(day, open, close, isClosed) {
      try {
        await fetch(`${API_BASE}/api/admin/hours/${day}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ open_time: open, close_time: close, is_closed: isClosed || false })
        });
        loadHours();
      } catch(err) {
        console.error('Error:', err);
      }
    }

    // ===== REVENUES =====
    async function loadRevenues() {
      try {
        if(STATE.appointments.length === 0) {
          await loadAppointments();
        }
        if(STATE.services.length === 0) {
          const res = await fetch(`${API_BASE}/services`);
          STATE.services = await res.json();
        }
        const { totals, dailyList } = computeRevenueTotals(STATE.appointments, STATE.services);
        document.getElementById('revToday').textContent = '$' + totals.today.toFixed(2);
        document.getElementById('revWeek').textContent = '$' + totals.week.toFixed(2);
        document.getElementById('revMonth').textContent = '$' + totals.month.toFixed(2);
        document.getElementById('revYear').textContent = '$' + totals.year.toFixed(2);

        const list = document.getElementById('revDailyList');
        if(dailyList.length === 0) {
          list.innerHTML = '<div class="no-data">Sin ingresos registrados</div>';
        } else {
          list.innerHTML = dailyList.map(d => `
            <div class="appointment-item" style="grid-template-columns: 1fr auto;">
              <div class="appointment-info">
                <div class="appointment-name">${d.date}</div>
              </div>
              <div class="appointment-actions">
                <span class="stat-value" style="font-size:1.4rem; color: var(--accent);">$${d.amount.toFixed(2)}</span>
              </div>
            </div>
          `).join('');
        }
      } catch(err) {
        console.error('Error:', err);
      }
    }

    // ===== PROMOTION =====
    async function loadPromotion() {
      try {
        const res = await fetch(`${API_BASE}/api/admin/appointments`);
        const appts = await res.json();
        const unique = {};
        appts.forEach(a => {
          if(!a.phone) return;
          const name = a.customer_name && a.customer_name.trim() ? a.customer_name : 'Cliente';
          if(!unique[a.phone]) unique[a.phone] = { name, phone: a.phone };
        });
        const clients = Object.values(unique);
        const container = document.getElementById('promoClients');
        if(clients.length === 0) {
          container.innerHTML = '<div class="no-data">No hay clientes con tel√©fono registrado</div>';
          return;
        }
        container.innerHTML = clients.map(c => `
          <label style="display:flex; align-items:center; gap:10px; padding:10px 12px; border:1px solid var(--border); border-radius:10px;">
            <input type="checkbox" class="promo-check" value="${c.phone}" checked style="width:18px; height:18px;">
            <div style="flex:1;">
              <div style="font-weight:800;">${c.name}</div>
              <div style="color: var(--text-light);">${c.phone}</div>
            </div>
          </label>
        `).join('');
      } catch(err) {
        console.error('Error:', err);
      }
    }

    async function sendPromotion() {
      const message = document.getElementById('promoMessage').value.trim();
      if(!message) {
        alert('Escribe un mensaje primero');
        return;
      }
      const phones = Array.from(document.querySelectorAll('.promo-check:checked')).map(c => c.value);
      if(phones.length === 0) {
        alert('Selecciona al menos un cliente');
        return;
      }
      try {
        await fetch(`${API_BASE}/api/admin/send-whatsapp`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message, phones })
        });
        alert('Mensaje enviado');
      } catch(err) {
        console.error('Error:', err);
        alert('No se pudo enviar el mensaje');
      }
    }

    // Modal click outside
    document.getElementById('serviceModal').addEventListener('click', (e) => {
      if(e.target.id === 'serviceModal') closeServiceModal();
    });
  </script>
</body>
</html>
